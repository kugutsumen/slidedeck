<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" media="all" 
  href="file:///XXX/theme/css/default.css">
</head>
<body style="opacity: 0" >
<slides class="layout-widescreen">

  <slide class="logoslide nobackground">
    <article class="flexbox vcenter">
      <span><img src="images/google_developers_logo.png"></span>
    </article>
  </slide>

  <slide class="title-slide segue nobackground">
    <aside class="gdbar">
      <img src="images/google_developers_icon_128.png">
    </aside>
    <hgroup class="auto-fadein">
      <h1>{{ presentation_title }}</h1>
      <h2>{{ subtitle }}</h2>
      <p>{{ authors }}</p>
    </hgroup>
  </slide>

  <slide>
    <hgroup>
      <h2>Slide with Bullets</h2>
    </hgroup>
    <article>
      <ul>
        <li>Titles are formatted as Open Sans with bold applied and font size 
          is set at 45</li>
        <li>Title capitalization is title case
          <ul>
            <li>Subtitle capitalization is title case</li>
          </ul>
        </li>
        <li>Subtitle capitalization is title case</li>
        <li>Titles and subtitles should never have a period at the end</li>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>Slide with Bullets that Build</h2>
      <h3>Subtitle Placeholder</h3>
    </hgroup>
    <article>
      <p>A list where items build:</p>
      <ul class="build">
        <li>Pressing 'h' highlights code snippets</li>
        <li>Pressing 'p' toggles speaker notes (if they're on the current 
          slide)</li>
        <li>Pressing 'f' toggles fullscreen viewing</li>
        <li>Pressing 'w' toggles widescreen</li>
        <li>Pressing 'o' toggles overview mode</li>
        <li>Pressing 'ESC' toggles off these goodies</li>
      </ul>
      <p>Another list, but items fade as they build:</p>
      <ul class="build fade">
        <li>Hover over me!</li>
        <li>Hover over me!</li>
      </ul>
    </article>
  </slide>


  <slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right">
      <img src="images/google_developers_icon_128.png">
    </aside>
    <article class="flexbox vleft auto-fadein">
      <h2>&lt;Thank You!&gt;</h2>
      <p>Important contact information goes here.</p>
    </article>
    <p class="auto-fadein" data-config-contact>
      {{ contact_info }}
    </p>
  </slide>

  <slide class="logoslide dark nobackground">
    <article class="flexbox vcenter">
      <span><img src="images/google_developers_logo_white.png"></span>
    </article>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<script type="application/dart">
import 'dart:async';
import 'dart:html';

var presentation_title = 'Our Awesome preso in Dart';
var subtitle = 'A subtitle';
var authors = 'Emily Fortuna and Siggi Cherem';
var contact_info = '';

main() {
  new Timer(new Duration(), present);  
}

present() {
  document.body.classes.add('loaded');
  var p = new Presentation();
}

class Presentation {
  int _currentSlideIndex;
  List<Element> _slides;

  Presentation() {
    KeyboardEventStream.onKeyDown(document.body).listen(handleKeydown);
    _slides = document.queryAll('slide:not([hidden]):not(.backdrop)');
    try {
      _currentSlideIndex = int.parse(window.location.hash.substring(1));
    } catch (Exception) {
      _currentSlideIndex = 0;
    }
    initBuildInLists();
    _slides[_currentSlideIndex].classes.add('current');
  }

  void initBuildInLists() {
    var buildItems = document.queryAll('.build > *');
    for (Element item in buildItems) {
      item.classes.add('to-build');
      if (item.parent.classes.contains('fade')) {
        item.classes.add('fade');
      }
    }
  }

  handleKeydown(KeyEvent e) {
    switch (e.keyCode) {
      case KeyCode.RIGHT:
      case KeyCode.SPACE:
      case KeyCode.PAGE_DOWN:
      case KeyCode.DOWN:
        next();
        break;
      case KeyCode.LEFT:
      case KeyCode.BACKSPACE:
      case KeyCode.PAGE_UP:
      case KeyCode.UP:
        previous();
        break;
    }
  }

  /**
   * Attempt to make the next incremental item on this particular slide appear. 
   * Return true if we successfully built something additional onto the slide,
   * false if there was nothing additional to build onto this slide.
   */
  bool buildNextItem() {
    var itemToBuildNext = currentSlide.query('.to-build');
    var currentlyBuilt = currentSlide.query('.build-current');

    if (currentlyBuilt != null) {
      currentlyBuilt.classes.remove('build-current');
      if (currentlyBuilt.classes.contains('fade')) {
        currentlyBuilt.classes.add('build-fade');
      }
    }

    if (itemToBuildNext == null) {
      // Go to next slide.
      // TODO(efortuna): Change this when jQuery CL goes in.
      currentSlide.queryAll('.build-fade').forEach(
          (e) => e.classes.remove('build-fade'));
      return false;
    } else {
      itemToBuildNext.classes.remove('to-build');
      itemToBuildNext.classes.add('build-current');
      return true;
    }
  }

  Element get currentSlide => _slides[_currentSlideIndex];

  /**
   * Move to the next item, be it building in the next item on the current
   * slide, or advancing to the next slide.
   */
  next() {
    if (!buildNextItem()) {
      // Move to next slide, if possible.
      if(_currentSlideIndex < _slides.length - 1) {
        _currentSlideIndex++;
        _updateSlides();
      }
    }
  }

  _updateSlides() {
    var currentSlide = _currentSlideIndex;

    // Remove all slide classes because we're advancing them all.
    // TODO(efortuna): jQuery update.
    _slides.forEach((slide) => slide.classes.removeAll(
        ['far-past', 'past', 'current', 'next', 'far-next']));

    for (int i = 0; i < _slides.length; i++) {
      switch(i) {
        case currentSlide - 2:
          _slides[i].classes.add('far-past');
          break;
        case currentSlide - 1:
          _slides[i].classes.add('past');
          break;
        case currentSlide:
          _slides[i].classes.add('current');
          break;
        case currentSlide + 1:
          _slides[i].classes.add('next');
          break;
        case currentSlide + 2:
          _slides[i].classes.add('far-next');
          break;
      }
    }
    window.location.replace('#$_currentSlideIndex');
  }

  previous() {
    if(_currentSlideIndex > 0) {
      _currentSlideIndex--;
      _updateSlides();
    }
  }
}
</script>
</body>
</html>
